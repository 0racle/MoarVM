# SYNTAX: opcode ':' s-exp
#    s-exp represents tree

# Number with dollars stand for the arguments of the opcode.  The
# opcode preprocessor inserts loads, and immediate nodes for arguments
# automatically.

const_i16:   (copy $1) 
const_i64:   (copy $1)
set:         (copy $1)
getwhat:     (load (addr (load (addr $1 (&offsetof MVMObject st)) ptr_sz)
                         (&offsetof MVMSTable WHAT)) ptr_sz)
# getwho is getwhat with a nonzero check
getwho:      (let (($who
                    (load (addr (load (addr $1 (&offsetof MVMObject st)) ptr_sz)
                         (&offsetof MVMSTable WHAT)) ptr_sz)))
                  (ifelse (nz $who) $who (vmnull)))
# This is perhaps a bit long for a simple function
say:         (call (const (&funcptr &MVM_string_say) ptr_sz)
                   (arglist 1 (carg $1 reg_val))
                    void)
add_i:       (add $1 $2)
sp_getarg_o: (load (addr fargs $1) ptr_sz)
sp_getarg_i: (load (addr fargs $1) (&sizeof MVMint64))
null_s:      (const 0 (&sizeof MVMString*))
