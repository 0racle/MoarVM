# Compiler configuration
CC       = @cc@
CFLAGS   = @cflags@
CINCLUDE = -I3rdparty/apr/include -Isrc
LD       = @link@
LDFLAGS  = @ldflags@

# File extensions
EXE = @exe@
O   = @o@

# Tool configuration
MAKE = @make@

# APR related
APR_LIB = @apr_lib@
APR_BUILD_LINE = @apr_build_line@

# Various collections of libraries, objects and sources.
THIRDPARTY_LIBS = $(APR_LIB)
CORE_OBJS = src/moarvm$(O)
MAIN_OBJ = src/main$(O)
HEADERS = src/moarvm.h

# Main target
moarvm$(EXE): $(THIRDPARTY_LIBS) $(CORE_OBJS) $(MAIN_OBJ)
	$(LD) -out:moarvm$(EXE) $(LDFLAGS) $(CORE_OBJS) $(MAIN_OBJ) $(THIRDPARTY_LIBS)

# APR
$(APR_LIB):
	$(APR_BUILD_LINE)

# VM core compilation.
src/main$(O): src/main.c $(HEADERS)
	$(CC) $(CINCLUDE) $(CFLAGS) -c -Fosrc/main$(O) src/main.c
src/moarvm$(O): src/moarvm.c $(HEADERS)
	$(CC) $(CINCLUDE) $(CFLAGS) -c -Fosrc/moarvm$(O) src/moarvm.c
